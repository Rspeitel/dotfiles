#!/bin/sh

theme="launcher.rasi"
dir="$HOME/.config/rofi/"

rofi_command="rofi -theme $dir/$theme -dmenu -i"

declare -A arr_rofi
declare -A arr_choice

first_line=true

while IFS=, read -r tag program comment needed title execc icon; do
  # Check if we are on the first line
  if [ $first_line == true ]; then
    first_line=false && continue
  fi

  # Remove qoutes from title
  echo "$title" | grep -q "^\".*\"$" && title="$(echo "$title" | sed "s/\(^\"\|\"$\)//g")"
  echo "$execc" | grep -q "^\".*\"$" && execc="$(echo "$execc" | sed "s/\(^\"\|\"$\)//g")"

  # Add all the programs into an array
  if ! [[ -z "$title" ]]; then
    arr_rofi+=("$title\0icon\x1f$icon")
    arr_choice["$title"]="$execc"
  fi
done < ~/dotfiles/progs.csv

choice=$(echo -en "$(printf "%s\n" "${!arr_rofi[@]}")" | $rofi_command)

echo $choice
echo ${arr_choice[$choice]}

[ $? = 0 ] && ${arr_choice[$choice]}
